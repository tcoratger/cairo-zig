<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <title>utils/time.zig - source view</title>
    <link rel="icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAgklEQVR4AWMYWuD7EllJIM4G4g4g5oIJ/odhOJ8wToOxSTXgNxDHoeiBMfA4+wGShjyYOCkG/IGqWQziEzYAoUAeiF9D5U+DxEg14DRU7jWIT5IBIOdCxf+A+CQZAAoopEB7QJwBCBwHiip8UYmRdrAlDpIMgApwQZNnNii5Dq0MBgCxxycBnwEd+wAAAABJRU5ErkJggg==">
    <link rel="icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxNTMgMTQwIj48ZyBmaWxsPSIjRjdBNDFEIj48Zz48cG9seWdvbiBwb2ludHM9IjQ2LDIyIDI4LDQ0IDE5LDMwIi8+PHBvbHlnb24gcG9pbnRzPSI0NiwyMiAzMywzMyAyOCw0NCAyMiw0NCAyMiw5NSAzMSw5NSAyMCwxMDAgMTIsMTE3IDAsMTE3IDAsMjIiIHNoYXBlLXJlbmRlcmluZz0iY3Jpc3BFZGdlcyIvPjxwb2x5Z29uIHBvaW50cz0iMzEsOTUgMTIsMTE3IDQsMTA2Ii8+PC9nPjxnPjxwb2x5Z29uIHBvaW50cz0iNTYsMjIgNjIsMzYgMzcsNDQiLz48cG9seWdvbiBwb2ludHM9IjU2LDIyIDExMSwyMiAxMTEsNDQgMzcsNDQgNTYsMzIiIHNoYXBlLXJlbmRlcmluZz0iY3Jpc3BFZGdlcyIvPjxwb2x5Z29uIHBvaW50cz0iMTE2LDk1IDk3LDExNyA5MCwxMDQiLz48cG9seWdvbiBwb2ludHM9IjExNiw5NSAxMDAsMTA0IDk3LDExNyA0MiwxMTcgNDIsOTUiIHNoYXBlLXJlbmRlcmluZz0iY3Jpc3BFZGdlcyIvPjxwb2x5Z29uIHBvaW50cz0iMTUwLDAgNTIsMTE3IDMsMTQwIDEwMSwyMiIvPjwvZz48Zz48cG9seWdvbiBwb2ludHM9IjE0MSwyMiAxNDAsNDAgMTIyLDQ1Ii8+PHBvbHlnb24gcG9pbnRzPSIxNTMsMjIgMTUzLDExNyAxMDYsMTE3IDEyMCwxMDUgMTI1LDk1IDEzMSw5NSAxMzEsNDUgMTIyLDQ1IDEzMiwzNiAxNDEsMjIiIHNoYXBlLXJlbmRlcmluZz0iY3Jpc3BFZGdlcyIvPjxwb2x5Z29uIHBvaW50cz0iMTI1LDk1IDEzMCwxMTAgMTA2LDExNyIvPjwvZz48L2c+PC9zdmc+">
    <style>
      body{
        font-family: system-ui, -apple-system, Roboto, "Segoe UI", sans-serif;
        margin: 0;
        line-height: 1.5;
      }

      pre > code {
        display: block;
        overflow: auto;
        line-height: normal;
        margin: 0em;
      }
      .tok-kw {
          color: #333;
          font-weight: bold;
      }
      .tok-str {
          color: #d14;
      }
      .tok-builtin {
          color: #005C7A;
      }
      .tok-comment {
          color: #545454;
          font-style: italic;
      }
      .tok-fn {
          color: #900;
          font-weight: bold;
      }
      .tok-null {
          color: #005C5C;
      }
      .tok-number {
          color: #005C5C;
      }
      .tok-type {
          color: #458;
          font-weight: bold;
      }
      pre {
        counter-reset: line;
      }
      pre .line:before {
        counter-increment: line;
        content: counter(line);
        display: inline-block;
        padding-right: 1em;
        width: 2em;
        text-align: right;
        color: #999;
      }
      
      .line {
        width: 100%;
        display: inline-block;
      }
      .line:target {
        border-top: 1px solid #ccc;
        border-bottom: 1px solid #ccc;
        background: #fafafa;
      }

      @media (prefers-color-scheme: dark) {
        body{
            background:#222;
            color: #ccc;
        }
        pre > code {
            color: #ccc;
            background: #222;
            border: unset;
        }
        .line:target {
            border-top: 1px solid #444;
            border-bottom: 1px solid #444;
            background: #333;
        }
        .tok-kw {
            color: #eee;
        }
        .tok-str {
            color: #2e5;
        }
        .tok-builtin {
            color: #ff894c;
        }
        .tok-comment {
            color: #aa7;
        }
        .tok-fn {
            color: #B1A0F8;
        }
        .tok-null {
            color: #ff8080;
        }
        .tok-number {
            color: #ff8080;
        }
        .tok-type {
            color: #68f;
        }
      }
    </style>
</head>
<body>
<pre><code><span class="line" id="L1"><span class="tok-comment">//  Source: https://github.com/nektro/zig-time/commit/ca9c0e6b644d74c1d549cc2c1ee22113aa021bd8</span>
</span>
<span class="line" id="L2"><span class="tok-comment">//</span>
</span>
<span class="line" id="L3"><span class="tok-comment">//  MIT License</span>
</span>
<span class="line" id="L4"><span class="tok-comment">//</span>
</span>
<span class="line" id="L5"><span class="tok-comment">//  Copyright (c) 2021 Meghan Denny</span>
</span>
<span class="line" id="L6"><span class="tok-comment">//</span>
</span>
<span class="line" id="L7"><span class="tok-comment">//  Permission is hereby granted, free of charge, to any person obtaining a copy of</span>
</span>
<span class="line" id="L8"><span class="tok-comment">//  this software and associated documentation files (the &quot;Software&quot;), to deal in</span>
</span>
<span class="line" id="L9"><span class="tok-comment">//  the Software without restriction, including without limitation the rights to</span>
</span>
<span class="line" id="L10"><span class="tok-comment">//  use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of</span>
</span>
<span class="line" id="L11"><span class="tok-comment">//  the Software, and to permit persons to whom the Software is furnished to do so,</span>
</span>
<span class="line" id="L12"><span class="tok-comment">//  subject to the following conditions:</span>
</span>
<span class="line" id="L13"><span class="tok-comment">//</span>
</span>
<span class="line" id="L14"><span class="tok-comment">//  The above copyright notice and this permission notice shall be included in all</span>
</span>
<span class="line" id="L15"><span class="tok-comment">//  copies or substantial portions of the Software.</span>
</span>
<span class="line" id="L16"><span class="tok-comment">//</span>
</span>
<span class="line" id="L17"><span class="tok-comment">//  THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
</span>
<span class="line" id="L18"><span class="tok-comment">//  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS</span>
</span>
<span class="line" id="L19"><span class="tok-comment">//  FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR</span>
</span>
<span class="line" id="L20"><span class="tok-comment">//  COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER</span>
</span>
<span class="line" id="L21"><span class="tok-comment">//  IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN</span>
</span>
<span class="line" id="L22"><span class="tok-comment">//  CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</span>
</span>
<span class="line" id="L23"></span>
<span class="line" id="L24"><span class="tok-kw">const</span> std = <span class="tok-builtin">@import</span>(<span class="tok-str">&quot;std&quot;</span>);</span>
<span class="line" id="L25"><span class="tok-kw">const</span> string = []<span class="tok-kw">const</span> <span class="tok-type">u8</span>;</span>
<span class="line" id="L26"><span class="tok-kw">const</span> time = <span class="tok-builtin">@This</span>();</span>
<span class="line" id="L27"></span>
<span class="line" id="L28"><span class="tok-kw">pub</span> <span class="tok-kw">const</span> DateTime = <span class="tok-kw">struct</span> {</span>
<span class="line" id="L29">    ms: <span class="tok-type">u16</span>,</span>
<span class="line" id="L30">    seconds: <span class="tok-type">u16</span>,</span>
<span class="line" id="L31">    minutes: <span class="tok-type">u16</span>,</span>
<span class="line" id="L32">    hours: <span class="tok-type">u16</span>,</span>
<span class="line" id="L33">    days: <span class="tok-type">u16</span>,</span>
<span class="line" id="L34">    months: <span class="tok-type">u16</span>,</span>
<span class="line" id="L35">    years: <span class="tok-type">u16</span>,</span>
<span class="line" id="L36">    timezone: TimeZone,</span>
<span class="line" id="L37">    weekday: WeekDay,</span>
<span class="line" id="L38">    era: Era,</span>
<span class="line" id="L39"></span>
<span class="line" id="L40">    <span class="tok-kw">const</span> Self = <span class="tok-builtin">@This</span>();</span>
<span class="line" id="L41"></span>
<span class="line" id="L42">    <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">initUnixMs</span>(unix: <span class="tok-type">u64</span>) Self {</span>
<span class="line" id="L43">        <span class="tok-kw">return</span> epoch_unix.addMs(unix);</span>
<span class="line" id="L44">    }</span>
<span class="line" id="L45"></span>
<span class="line" id="L46">    <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">initUnix</span>(unix: <span class="tok-type">u64</span>) Self {</span>
<span class="line" id="L47">        <span class="tok-kw">return</span> epoch_unix.addSecs(unix);</span>
<span class="line" id="L48">    }</span>
<span class="line" id="L49"></span>
<span class="line" id="L50">    <span class="tok-comment">/// Caller asserts that this is &gt; epoch</span></span>
<span class="line" id="L51">    <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">init</span>(</span>
<span class="line" id="L52">        year: <span class="tok-type">u16</span>,</span>
<span class="line" id="L53">        month: <span class="tok-type">u16</span>,</span>
<span class="line" id="L54">        day: <span class="tok-type">u16</span>,</span>
<span class="line" id="L55">        hr: <span class="tok-type">u16</span>,</span>
<span class="line" id="L56">        min: <span class="tok-type">u16</span>,</span>
<span class="line" id="L57">        sec: <span class="tok-type">u16</span>,</span>
<span class="line" id="L58">    ) Self {</span>
<span class="line" id="L59">        <span class="tok-kw">return</span> epoch_unix</span>
<span class="line" id="L60">            .addYears(year - epoch_unix.years)</span>
<span class="line" id="L61">            .addMonths(month)</span>
<span class="line" id="L62">            .addDays(day)</span>
<span class="line" id="L63">            .addHours(hr)</span>
<span class="line" id="L64">            .addMins(min)</span>
<span class="line" id="L65">            .addSecs(sec);</span>
<span class="line" id="L66">    }</span>
<span class="line" id="L67"></span>
<span class="line" id="L68">    <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">now</span>() Self {</span>
<span class="line" id="L69">        <span class="tok-kw">return</span> initUnixMs(</span>
<span class="line" id="L70">            <span class="tok-builtin">@as</span>(</span>
<span class="line" id="L71">                <span class="tok-type">u64</span>,</span>
<span class="line" id="L72">                <span class="tok-builtin">@intCast</span>(std.time.milliTimestamp()),</span>
<span class="line" id="L73">            ),</span>
<span class="line" id="L74">        );</span>
<span class="line" id="L75">    }</span>
<span class="line" id="L76"></span>
<span class="line" id="L77">    <span class="tok-kw">pub</span> <span class="tok-kw">const</span> epoch_unix = Self{</span>
<span class="line" id="L78">        .ms = <span class="tok-number">0</span>,</span>
<span class="line" id="L79">        .seconds = <span class="tok-number">0</span>,</span>
<span class="line" id="L80">        .minutes = <span class="tok-number">0</span>,</span>
<span class="line" id="L81">        .hours = <span class="tok-number">0</span>,</span>
<span class="line" id="L82">        .days = <span class="tok-number">0</span>,</span>
<span class="line" id="L83">        .months = <span class="tok-number">0</span>,</span>
<span class="line" id="L84">        .years = <span class="tok-number">1970</span>,</span>
<span class="line" id="L85">        .timezone = .UTC,</span>
<span class="line" id="L86">        .weekday = .Thu,</span>
<span class="line" id="L87">        .era = .AD,</span>
<span class="line" id="L88">    };</span>
<span class="line" id="L89"></span>
<span class="line" id="L90">    <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">eql</span>(</span>
<span class="line" id="L91">        self: Self,</span>
<span class="line" id="L92">        other: Self,</span>
<span class="line" id="L93">    ) <span class="tok-type">bool</span> {</span>
<span class="line" id="L94">        <span class="tok-kw">return</span> self.ms == other.ms <span class="tok-kw">and</span></span>
<span class="line" id="L95">            self.seconds == other.seconds <span class="tok-kw">and</span></span>
<span class="line" id="L96">            self.minutes == other.minutes <span class="tok-kw">and</span></span>
<span class="line" id="L97">            self.hours == other.hours <span class="tok-kw">and</span></span>
<span class="line" id="L98">            self.days == other.days <span class="tok-kw">and</span></span>
<span class="line" id="L99">            self.months == other.months <span class="tok-kw">and</span></span>
<span class="line" id="L100">            self.years == other.years <span class="tok-kw">and</span></span>
<span class="line" id="L101">            self.timezone == other.timezone <span class="tok-kw">and</span></span>
<span class="line" id="L102">            self.weekday == other.weekday;</span>
<span class="line" id="L103">    }</span>
<span class="line" id="L104"></span>
<span class="line" id="L105">    <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">addMs</span>(</span>
<span class="line" id="L106">        self: Self,</span>
<span class="line" id="L107">        count: <span class="tok-type">u64</span>,</span>
<span class="line" id="L108">    ) Self {</span>
<span class="line" id="L109">        <span class="tok-kw">if</span> (count == <span class="tok-number">0</span>) <span class="tok-kw">return</span> self;</span>
<span class="line" id="L110">        <span class="tok-kw">var</span> result = self;</span>
<span class="line" id="L111">        result.ms += <span class="tok-builtin">@as</span>(</span>
<span class="line" id="L112">            <span class="tok-type">u16</span>,</span>
<span class="line" id="L113">            <span class="tok-builtin">@intCast</span>(count % <span class="tok-number">1000</span>),</span>
<span class="line" id="L114">        );</span>
<span class="line" id="L115">        <span class="tok-kw">return</span> result.addSecs(count / <span class="tok-number">1000</span>);</span>
<span class="line" id="L116">    }</span>
<span class="line" id="L117"></span>
<span class="line" id="L118">    <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">addSecs</span>(</span>
<span class="line" id="L119">        self: Self,</span>
<span class="line" id="L120">        count: <span class="tok-type">u64</span>,</span>
<span class="line" id="L121">    ) Self {</span>
<span class="line" id="L122">        <span class="tok-kw">if</span> (count == <span class="tok-number">0</span>) <span class="tok-kw">return</span> self;</span>
<span class="line" id="L123">        <span class="tok-kw">var</span> result = self;</span>
<span class="line" id="L124">        result.seconds += <span class="tok-builtin">@as</span>(</span>
<span class="line" id="L125">            <span class="tok-type">u16</span>,</span>
<span class="line" id="L126">            <span class="tok-builtin">@intCast</span>(count % <span class="tok-number">60</span>),</span>
<span class="line" id="L127">        );</span>
<span class="line" id="L128">        <span class="tok-kw">return</span> result.addMins(count / <span class="tok-number">60</span>);</span>
<span class="line" id="L129">    }</span>
<span class="line" id="L130"></span>
<span class="line" id="L131">    <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">addMins</span>(</span>
<span class="line" id="L132">        self: Self,</span>
<span class="line" id="L133">        count: <span class="tok-type">u64</span>,</span>
<span class="line" id="L134">    ) Self {</span>
<span class="line" id="L135">        <span class="tok-kw">if</span> (count == <span class="tok-number">0</span>) <span class="tok-kw">return</span> self;</span>
<span class="line" id="L136">        <span class="tok-kw">var</span> result = self;</span>
<span class="line" id="L137">        result.minutes += <span class="tok-builtin">@as</span>(</span>
<span class="line" id="L138">            <span class="tok-type">u16</span>,</span>
<span class="line" id="L139">            <span class="tok-builtin">@intCast</span>(count % <span class="tok-number">60</span>),</span>
<span class="line" id="L140">        );</span>
<span class="line" id="L141">        <span class="tok-kw">return</span> result.addHours(count / <span class="tok-number">60</span>);</span>
<span class="line" id="L142">    }</span>
<span class="line" id="L143"></span>
<span class="line" id="L144">    <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">addHours</span>(</span>
<span class="line" id="L145">        self: Self,</span>
<span class="line" id="L146">        count: <span class="tok-type">u64</span>,</span>
<span class="line" id="L147">    ) Self {</span>
<span class="line" id="L148">        <span class="tok-kw">if</span> (count == <span class="tok-number">0</span>) <span class="tok-kw">return</span> self;</span>
<span class="line" id="L149">        <span class="tok-kw">var</span> result = self;</span>
<span class="line" id="L150">        result.hours += <span class="tok-builtin">@as</span>(</span>
<span class="line" id="L151">            <span class="tok-type">u16</span>,</span>
<span class="line" id="L152">            <span class="tok-builtin">@intCast</span>(count % <span class="tok-number">24</span>),</span>
<span class="line" id="L153">        );</span>
<span class="line" id="L154">        <span class="tok-kw">return</span> result.addDays(count / <span class="tok-number">24</span>);</span>
<span class="line" id="L155">    }</span>
<span class="line" id="L156"></span>
<span class="line" id="L157">    <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">addDays</span>(</span>
<span class="line" id="L158">        self: Self,</span>
<span class="line" id="L159">        count: <span class="tok-type">u64</span>,</span>
<span class="line" id="L160">    ) Self {</span>
<span class="line" id="L161">        <span class="tok-kw">if</span> (count == <span class="tok-number">0</span>) <span class="tok-kw">return</span> self;</span>
<span class="line" id="L162">        <span class="tok-kw">var</span> result = self;</span>
<span class="line" id="L163">        <span class="tok-kw">var</span> input = count;</span>
<span class="line" id="L164"></span>
<span class="line" id="L165">        <span class="tok-kw">while</span> (<span class="tok-null">true</span>) {</span>
<span class="line" id="L166">            <span class="tok-kw">const</span> year_len = result.daysThisYear();</span>
<span class="line" id="L167">            <span class="tok-kw">if</span> (input &gt;= year_len) {</span>
<span class="line" id="L168">                result.years += <span class="tok-number">1</span>;</span>
<span class="line" id="L169">                input -= year_len;</span>
<span class="line" id="L170">                result.incrementWeekday(year_len);</span>
<span class="line" id="L171">                <span class="tok-kw">continue</span>;</span>
<span class="line" id="L172">            }</span>
<span class="line" id="L173">            <span class="tok-kw">break</span>;</span>
<span class="line" id="L174">        }</span>
<span class="line" id="L175">        <span class="tok-kw">while</span> (<span class="tok-null">true</span>) {</span>
<span class="line" id="L176">            <span class="tok-kw">const</span> month_len = result.daysThisMonth();</span>
<span class="line" id="L177">            <span class="tok-kw">if</span> (input &gt;= month_len) {</span>
<span class="line" id="L178">                result.months += <span class="tok-number">1</span>;</span>
<span class="line" id="L179">                input -= month_len;</span>
<span class="line" id="L180">                result.incrementWeekday(month_len);</span>
<span class="line" id="L181"></span>
<span class="line" id="L182">                <span class="tok-kw">if</span> (result.months == <span class="tok-number">12</span>) {</span>
<span class="line" id="L183">                    result.years += <span class="tok-number">1</span>;</span>
<span class="line" id="L184">                    result.months = <span class="tok-number">0</span>;</span>
<span class="line" id="L185">                }</span>
<span class="line" id="L186">                <span class="tok-kw">continue</span>;</span>
<span class="line" id="L187">            }</span>
<span class="line" id="L188">            <span class="tok-kw">break</span>;</span>
<span class="line" id="L189">        }</span>
<span class="line" id="L190">        {</span>
<span class="line" id="L191">            <span class="tok-kw">const</span> month_len = result.daysThisMonth();</span>
<span class="line" id="L192">            <span class="tok-kw">if</span> (result.days + input &gt; month_len) {</span>
<span class="line" id="L193">                <span class="tok-kw">const</span> left = month_len - result.days;</span>
<span class="line" id="L194">                input -= left;</span>
<span class="line" id="L195">                result.months += <span class="tok-number">1</span>;</span>
<span class="line" id="L196">                result.days = <span class="tok-number">0</span>;</span>
<span class="line" id="L197">                result.incrementWeekday(left);</span>
<span class="line" id="L198">            }</span>
<span class="line" id="L199">            result.days += <span class="tok-builtin">@as</span>(</span>
<span class="line" id="L200">                <span class="tok-type">u16</span>,</span>
<span class="line" id="L201">                <span class="tok-builtin">@intCast</span>(input),</span>
<span class="line" id="L202">            );</span>
<span class="line" id="L203">            result.incrementWeekday(input);</span>
<span class="line" id="L204"></span>
<span class="line" id="L205">            <span class="tok-kw">if</span> (result.months == <span class="tok-number">12</span>) {</span>
<span class="line" id="L206">                result.years += <span class="tok-number">1</span>;</span>
<span class="line" id="L207">                result.months = <span class="tok-number">0</span>;</span>
<span class="line" id="L208">            }</span>
<span class="line" id="L209">        }</span>
<span class="line" id="L210"></span>
<span class="line" id="L211">        <span class="tok-kw">return</span> result;</span>
<span class="line" id="L212">    }</span>
<span class="line" id="L213"></span>
<span class="line" id="L214">    <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">addMonths</span>(</span>
<span class="line" id="L215">        self: Self,</span>
<span class="line" id="L216">        count: <span class="tok-type">u64</span>,</span>
<span class="line" id="L217">    ) Self {</span>
<span class="line" id="L218">        <span class="tok-kw">if</span> (count == <span class="tok-number">0</span>) <span class="tok-kw">return</span> self;</span>
<span class="line" id="L219">        <span class="tok-kw">var</span> result = self;</span>
<span class="line" id="L220">        <span class="tok-kw">var</span> input = count;</span>
<span class="line" id="L221">        <span class="tok-kw">while</span> (input &gt; <span class="tok-number">0</span>) {</span>
<span class="line" id="L222">            <span class="tok-kw">const</span> new = result.addDays(result.daysThisMonth());</span>
<span class="line" id="L223">            result = new;</span>
<span class="line" id="L224">            input -= <span class="tok-number">1</span>;</span>
<span class="line" id="L225">        }</span>
<span class="line" id="L226">        <span class="tok-kw">return</span> result;</span>
<span class="line" id="L227">    }</span>
<span class="line" id="L228"></span>
<span class="line" id="L229">    <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">addYears</span>(</span>
<span class="line" id="L230">        self: Self,</span>
<span class="line" id="L231">        count: <span class="tok-type">u64</span>,</span>
<span class="line" id="L232">    ) Self {</span>
<span class="line" id="L233">        <span class="tok-kw">if</span> (count == <span class="tok-number">0</span>) <span class="tok-kw">return</span> self;</span>
<span class="line" id="L234">        <span class="tok-kw">return</span> self.addMonths(count * <span class="tok-number">12</span>);</span>
<span class="line" id="L235">    }</span>
<span class="line" id="L236"></span>
<span class="line" id="L237">    <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">isLeapYear</span>(self: Self) <span class="tok-type">bool</span> {</span>
<span class="line" id="L238">        <span class="tok-kw">return</span> time.isLeapYear(self.years);</span>
<span class="line" id="L239">    }</span>
<span class="line" id="L240"></span>
<span class="line" id="L241">    <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">daysThisYear</span>(self: Self) <span class="tok-type">u16</span> {</span>
<span class="line" id="L242">        <span class="tok-kw">return</span> time.daysInYear(self.years);</span>
<span class="line" id="L243">    }</span>
<span class="line" id="L244"></span>
<span class="line" id="L245">    <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">daysThisMonth</span>(self: Self) <span class="tok-type">u16</span> {</span>
<span class="line" id="L246">        <span class="tok-kw">return</span> self.daysInMonth(self.months);</span>
<span class="line" id="L247">    }</span>
<span class="line" id="L248"></span>
<span class="line" id="L249">    <span class="tok-kw">fn</span> <span class="tok-fn">daysInMonth</span>(</span>
<span class="line" id="L250">        self: Self,</span>
<span class="line" id="L251">        month: <span class="tok-type">u16</span>,</span>
<span class="line" id="L252">    ) <span class="tok-type">u16</span> {</span>
<span class="line" id="L253">        <span class="tok-kw">return</span> time.daysInMonth(</span>
<span class="line" id="L254">            self.years,</span>
<span class="line" id="L255">            month,</span>
<span class="line" id="L256">        );</span>
<span class="line" id="L257">    }</span>
<span class="line" id="L258"></span>
<span class="line" id="L259">    <span class="tok-kw">fn</span> <span class="tok-fn">incrementWeekday</span>(</span>
<span class="line" id="L260">        self: *Self,</span>
<span class="line" id="L261">        count: <span class="tok-type">u64</span>,</span>
<span class="line" id="L262">    ) <span class="tok-type">void</span> {</span>
<span class="line" id="L263">        <span class="tok-kw">var</span> i = count % <span class="tok-number">7</span>;</span>
<span class="line" id="L264">        <span class="tok-kw">while</span> (i &gt; <span class="tok-number">0</span>) : (i -= <span class="tok-number">1</span>) {</span>
<span class="line" id="L265">            self.weekday = self.weekday.next();</span>
<span class="line" id="L266">        }</span>
<span class="line" id="L267">    }</span>
<span class="line" id="L268"></span>
<span class="line" id="L269">    <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">dayOfThisYear</span>(self: Self) <span class="tok-type">u16</span> {</span>
<span class="line" id="L270">        <span class="tok-kw">var</span> ret: <span class="tok-type">u16</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L271">        <span class="tok-kw">for</span> (<span class="tok-number">0</span>..self.months) |item| {</span>
<span class="line" id="L272">            ret += self.daysInMonth(</span>
<span class="line" id="L273">                <span class="tok-builtin">@as</span>(</span>
<span class="line" id="L274">                    <span class="tok-type">u16</span>,</span>
<span class="line" id="L275">                    <span class="tok-builtin">@intCast</span>(item),</span>
<span class="line" id="L276">                ),</span>
<span class="line" id="L277">            );</span>
<span class="line" id="L278">        }</span>
<span class="line" id="L279">        ret += self.days;</span>
<span class="line" id="L280">        <span class="tok-kw">return</span> ret;</span>
<span class="line" id="L281">    }</span>
<span class="line" id="L282"></span>
<span class="line" id="L283">    <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">toUnix</span>(self: Self) <span class="tok-type">u64</span> {</span>
<span class="line" id="L284">        <span class="tok-kw">const</span> x = self.toUnixMilli();</span>
<span class="line" id="L285">        <span class="tok-kw">return</span> x / <span class="tok-number">1000</span>;</span>
<span class="line" id="L286">    }</span>
<span class="line" id="L287"></span>
<span class="line" id="L288">    <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">toUnixMilli</span>(self: Self) <span class="tok-type">u64</span> {</span>
<span class="line" id="L289">        <span class="tok-kw">var</span> res: <span class="tok-type">u64</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L290">        res += self.ms;</span>
<span class="line" id="L291">        res += <span class="tok-builtin">@as</span>(</span>
<span class="line" id="L292">            <span class="tok-type">u64</span>,</span>
<span class="line" id="L293">            <span class="tok-builtin">@intCast</span>(self.seconds),</span>
<span class="line" id="L294">        ) * std.time.ms_per_s;</span>
<span class="line" id="L295">        res += <span class="tok-builtin">@as</span>(</span>
<span class="line" id="L296">            <span class="tok-type">u64</span>,</span>
<span class="line" id="L297">            <span class="tok-builtin">@intCast</span>(self.minutes),</span>
<span class="line" id="L298">        ) * std.time.ms_per_min;</span>
<span class="line" id="L299">        res += <span class="tok-builtin">@as</span>(</span>
<span class="line" id="L300">            <span class="tok-type">u64</span>,</span>
<span class="line" id="L301">            <span class="tok-builtin">@intCast</span>(self.hours),</span>
<span class="line" id="L302">        ) * std.time.ms_per_hour;</span>
<span class="line" id="L303">        res += self.daysSinceEpoch() * std.time.ms_per_day;</span>
<span class="line" id="L304">        <span class="tok-kw">return</span> res;</span>
<span class="line" id="L305">    }</span>
<span class="line" id="L306"></span>
<span class="line" id="L307">    <span class="tok-kw">fn</span> <span class="tok-fn">daysSinceEpoch</span>(self: Self) <span class="tok-type">u64</span> {</span>
<span class="line" id="L308">        <span class="tok-kw">var</span> res: <span class="tok-type">u64</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L309">        res += self.days;</span>
<span class="line" id="L310">        <span class="tok-kw">for</span> (<span class="tok-number">0</span>..self.years - epoch_unix.years) |i| res += time.daysInYear(</span>
<span class="line" id="L311">            <span class="tok-builtin">@as</span>(</span>
<span class="line" id="L312">                <span class="tok-type">u16</span>,</span>
<span class="line" id="L313">                <span class="tok-builtin">@intCast</span>(i),</span>
<span class="line" id="L314">            ),</span>
<span class="line" id="L315">        );</span>
<span class="line" id="L316">        <span class="tok-kw">for</span> (<span class="tok-number">0</span>..self.months) |i| res += self.daysInMonth(</span>
<span class="line" id="L317">            <span class="tok-builtin">@as</span>(</span>
<span class="line" id="L318">                <span class="tok-type">u16</span>,</span>
<span class="line" id="L319">                <span class="tok-builtin">@intCast</span>(i),</span>
<span class="line" id="L320">            ),</span>
<span class="line" id="L321">        );</span>
<span class="line" id="L322">        <span class="tok-kw">return</span> res;</span>
<span class="line" id="L323">    }</span>
<span class="line" id="L324"></span>
<span class="line" id="L325">    <span class="tok-comment">/// fmt is based on https://momentjs.com/docs/#/displaying/format/</span></span>
<span class="line" id="L326">    <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">format</span>(</span>
<span class="line" id="L327">        self: Self,</span>
<span class="line" id="L328">        <span class="tok-kw">comptime</span> fmt: string,</span>
<span class="line" id="L329">        options: std.fmt.FormatOptions,</span>
<span class="line" id="L330">        writer: <span class="tok-kw">anytype</span>,</span>
<span class="line" id="L331">    ) !<span class="tok-type">void</span> {</span>
<span class="line" id="L332">        _ = options;</span>
<span class="line" id="L333"></span>
<span class="line" id="L334">        <span class="tok-kw">if</span> (fmt.len == <span class="tok-number">0</span>) <span class="tok-builtin">@compileError</span>(<span class="tok-str">&quot;DateTime: format string can't be empty&quot;</span>);</span>
<span class="line" id="L335"></span>
<span class="line" id="L336">        <span class="tok-builtin">@setEvalBranchQuota</span>(<span class="tok-number">100000</span>);</span>
<span class="line" id="L337"></span>
<span class="line" id="L338">        <span class="tok-kw">comptime</span> <span class="tok-kw">var</span> s = <span class="tok-number">0</span>;</span>
<span class="line" id="L339">        <span class="tok-kw">comptime</span> <span class="tok-kw">var</span> e = <span class="tok-number">0</span>;</span>
<span class="line" id="L340">        <span class="tok-kw">comptime</span> <span class="tok-kw">var</span> next: ?FormatSeq = <span class="tok-null">null</span>;</span>
<span class="line" id="L341">        <span class="tok-kw">inline</span> <span class="tok-kw">for</span> (</span>
<span class="line" id="L342">            fmt,</span>
<span class="line" id="L343">            <span class="tok-number">0</span>..,</span>
<span class="line" id="L344">        ) |c, i| {</span>
<span class="line" id="L345">            e = i + <span class="tok-number">1</span>;</span>
<span class="line" id="L346"></span>
<span class="line" id="L347">            <span class="tok-kw">if</span> (<span class="tok-kw">comptime</span> std.meta.stringToEnum(</span>
<span class="line" id="L348">                FormatSeq,</span>
<span class="line" id="L349">                fmt[s..e],</span>
<span class="line" id="L350">            )) |tag| {</span>
<span class="line" id="L351">                next = tag;</span>
<span class="line" id="L352">                <span class="tok-kw">if</span> (i &lt; fmt.len - <span class="tok-number">1</span>) <span class="tok-kw">continue</span>;</span>
<span class="line" id="L353">            }</span>
<span class="line" id="L354"></span>
<span class="line" id="L355">            <span class="tok-kw">if</span> (next) |tag| {</span>
<span class="line" id="L356">                <span class="tok-kw">switch</span> (tag) {</span>
<span class="line" id="L357">                    .MM =&gt; <span class="tok-kw">try</span> writer.print(</span>
<span class="line" id="L358">                        <span class="tok-str">&quot;{:0&gt;2}&quot;</span>,</span>
<span class="line" id="L359">                        .{self.months + <span class="tok-number">1</span>},</span>
<span class="line" id="L360">                    ),</span>
<span class="line" id="L361">                    .M =&gt; <span class="tok-kw">try</span> writer.print(</span>
<span class="line" id="L362">                        <span class="tok-str">&quot;{}&quot;</span>,</span>
<span class="line" id="L363">                        .{self.months + <span class="tok-number">1</span>},</span>
<span class="line" id="L364">                    ),</span>
<span class="line" id="L365">                    .Mo =&gt; <span class="tok-kw">try</span> printOrdinal(</span>
<span class="line" id="L366">                        writer,</span>
<span class="line" id="L367">                        self.months + <span class="tok-number">1</span>,</span>
<span class="line" id="L368">                    ),</span>
<span class="line" id="L369">                    .MMM =&gt; <span class="tok-kw">try</span> printLongName(</span>
<span class="line" id="L370">                        writer,</span>
<span class="line" id="L371">                        self.months,</span>
<span class="line" id="L372">                        &amp;[_]string{</span>
<span class="line" id="L373">                            <span class="tok-str">&quot;Jan&quot;</span>,</span>
<span class="line" id="L374">                            <span class="tok-str">&quot;Feb&quot;</span>,</span>
<span class="line" id="L375">                            <span class="tok-str">&quot;Mar&quot;</span>,</span>
<span class="line" id="L376">                            <span class="tok-str">&quot;Apr&quot;</span>,</span>
<span class="line" id="L377">                            <span class="tok-str">&quot;May&quot;</span>,</span>
<span class="line" id="L378">                            <span class="tok-str">&quot;Jun&quot;</span>,</span>
<span class="line" id="L379">                            <span class="tok-str">&quot;Jul&quot;</span>,</span>
<span class="line" id="L380">                            <span class="tok-str">&quot;Aug&quot;</span>,</span>
<span class="line" id="L381">                            <span class="tok-str">&quot;Sep&quot;</span>,</span>
<span class="line" id="L382">                            <span class="tok-str">&quot;Oct&quot;</span>,</span>
<span class="line" id="L383">                            <span class="tok-str">&quot;Nov&quot;</span>,</span>
<span class="line" id="L384">                            <span class="tok-str">&quot;Dec&quot;</span>,</span>
<span class="line" id="L385">                        },</span>
<span class="line" id="L386">                    ),</span>
<span class="line" id="L387">                    .MMMM =&gt; <span class="tok-kw">try</span> printLongName(</span>
<span class="line" id="L388">                        writer,</span>
<span class="line" id="L389">                        self.months,</span>
<span class="line" id="L390">                        &amp;[_]string{</span>
<span class="line" id="L391">                            <span class="tok-str">&quot;January&quot;</span>,</span>
<span class="line" id="L392">                            <span class="tok-str">&quot;February&quot;</span>,</span>
<span class="line" id="L393">                            <span class="tok-str">&quot;March&quot;</span>,</span>
<span class="line" id="L394">                            <span class="tok-str">&quot;April&quot;</span>,</span>
<span class="line" id="L395">                            <span class="tok-str">&quot;May&quot;</span>,</span>
<span class="line" id="L396">                            <span class="tok-str">&quot;June&quot;</span>,</span>
<span class="line" id="L397">                            <span class="tok-str">&quot;July&quot;</span>,</span>
<span class="line" id="L398">                            <span class="tok-str">&quot;August&quot;</span>,</span>
<span class="line" id="L399">                            <span class="tok-str">&quot;September&quot;</span>,</span>
<span class="line" id="L400">                            <span class="tok-str">&quot;October&quot;</span>,</span>
<span class="line" id="L401">                            <span class="tok-str">&quot;November&quot;</span>,</span>
<span class="line" id="L402">                            <span class="tok-str">&quot;December&quot;</span>,</span>
<span class="line" id="L403">                        },</span>
<span class="line" id="L404">                    ),</span>
<span class="line" id="L405"></span>
<span class="line" id="L406">                    .Q =&gt; <span class="tok-kw">try</span> writer.print(</span>
<span class="line" id="L407">                        <span class="tok-str">&quot;{}&quot;</span>,</span>
<span class="line" id="L408">                        .{self.months / <span class="tok-number">3</span> + <span class="tok-number">1</span>},</span>
<span class="line" id="L409">                    ),</span>
<span class="line" id="L410">                    .Qo =&gt; <span class="tok-kw">try</span> printOrdinal(</span>
<span class="line" id="L411">                        writer,</span>
<span class="line" id="L412">                        self.months / <span class="tok-number">3</span> + <span class="tok-number">1</span>,</span>
<span class="line" id="L413">                    ),</span>
<span class="line" id="L414"></span>
<span class="line" id="L415">                    .D =&gt; <span class="tok-kw">try</span> writer.print(</span>
<span class="line" id="L416">                        <span class="tok-str">&quot;{}&quot;</span>,</span>
<span class="line" id="L417">                        .{self.days + <span class="tok-number">1</span>},</span>
<span class="line" id="L418">                    ),</span>
<span class="line" id="L419">                    .Do =&gt; <span class="tok-kw">try</span> printOrdinal(</span>
<span class="line" id="L420">                        writer,</span>
<span class="line" id="L421">                        self.days + <span class="tok-number">1</span>,</span>
<span class="line" id="L422">                    ),</span>
<span class="line" id="L423">                    .DD =&gt; <span class="tok-kw">try</span> writer.print(</span>
<span class="line" id="L424">                        <span class="tok-str">&quot;{:0&gt;2}&quot;</span>,</span>
<span class="line" id="L425">                        .{self.days + <span class="tok-number">1</span>},</span>
<span class="line" id="L426">                    ),</span>
<span class="line" id="L427"></span>
<span class="line" id="L428">                    .DDD =&gt; <span class="tok-kw">try</span> writer.print(</span>
<span class="line" id="L429">                        <span class="tok-str">&quot;{}&quot;</span>,</span>
<span class="line" id="L430">                        .{self.dayOfThisYear() + <span class="tok-number">1</span>},</span>
<span class="line" id="L431">                    ),</span>
<span class="line" id="L432">                    .DDDo =&gt; <span class="tok-kw">try</span> printOrdinal(</span>
<span class="line" id="L433">                        writer,</span>
<span class="line" id="L434">                        self.dayOfThisYear() + <span class="tok-number">1</span>,</span>
<span class="line" id="L435">                    ),</span>
<span class="line" id="L436">                    .DDDD =&gt; <span class="tok-kw">try</span> writer.print(</span>
<span class="line" id="L437">                        <span class="tok-str">&quot;{:0&gt;3}&quot;</span>,</span>
<span class="line" id="L438">                        .{self.dayOfThisYear() + <span class="tok-number">1</span>},</span>
<span class="line" id="L439">                    ),</span>
<span class="line" id="L440"></span>
<span class="line" id="L441">                    .d =&gt; <span class="tok-kw">try</span> writer.print(</span>
<span class="line" id="L442">                        <span class="tok-str">&quot;{}&quot;</span>,</span>
<span class="line" id="L443">                        .{<span class="tok-builtin">@intFromEnum</span>(self.weekday)},</span>
<span class="line" id="L444">                    ),</span>
<span class="line" id="L445">                    .do =&gt; <span class="tok-kw">try</span> printOrdinal(</span>
<span class="line" id="L446">                        writer,</span>
<span class="line" id="L447">                        <span class="tok-builtin">@intFromEnum</span>(self.weekday),</span>
<span class="line" id="L448">                    ),</span>
<span class="line" id="L449">                    .dd =&gt; <span class="tok-kw">try</span> writer.writeAll(<span class="tok-builtin">@tagName</span>(self.weekday)[<span class="tok-number">0</span>..<span class="tok-number">2</span>]),</span>
<span class="line" id="L450">                    .ddd =&gt; <span class="tok-kw">try</span> writer.writeAll(<span class="tok-builtin">@tagName</span>(self.weekday)),</span>
<span class="line" id="L451">                    .dddd =&gt; <span class="tok-kw">try</span> printLongName(</span>
<span class="line" id="L452">                        writer,</span>
<span class="line" id="L453">                        <span class="tok-builtin">@intFromEnum</span>(self.weekday),</span>
<span class="line" id="L454">                        &amp;[_]string{</span>
<span class="line" id="L455">                            <span class="tok-str">&quot;Sunday&quot;</span>,</span>
<span class="line" id="L456">                            <span class="tok-str">&quot;Monday&quot;</span>,</span>
<span class="line" id="L457">                            <span class="tok-str">&quot;Tuesday&quot;</span>,</span>
<span class="line" id="L458">                            <span class="tok-str">&quot;Wednesday&quot;</span>,</span>
<span class="line" id="L459">                            <span class="tok-str">&quot;Thursday&quot;</span>,</span>
<span class="line" id="L460">                            <span class="tok-str">&quot;Friday&quot;</span>,</span>
<span class="line" id="L461">                            <span class="tok-str">&quot;Saturday&quot;</span>,</span>
<span class="line" id="L462">                        },</span>
<span class="line" id="L463">                    ),</span>
<span class="line" id="L464">                    .e =&gt; <span class="tok-kw">try</span> writer.print(</span>
<span class="line" id="L465">                        <span class="tok-str">&quot;{}&quot;</span>,</span>
<span class="line" id="L466">                        .{<span class="tok-builtin">@intFromEnum</span>(self.weekday)},</span>
<span class="line" id="L467">                    ),</span>
<span class="line" id="L468">                    .E =&gt; <span class="tok-kw">try</span> writer.print(</span>
<span class="line" id="L469">                        <span class="tok-str">&quot;{}&quot;</span>,</span>
<span class="line" id="L470">                        .{<span class="tok-builtin">@intFromEnum</span>(self.weekday) + <span class="tok-number">1</span>},</span>
<span class="line" id="L471">                    ),</span>
<span class="line" id="L472"></span>
<span class="line" id="L473">                    .w =&gt; <span class="tok-kw">try</span> writer.print(</span>
<span class="line" id="L474">                        <span class="tok-str">&quot;{}&quot;</span>,</span>
<span class="line" id="L475">                        .{self.dayOfThisYear() / <span class="tok-number">7</span> + <span class="tok-number">1</span>},</span>
<span class="line" id="L476">                    ),</span>
<span class="line" id="L477">                    .wo =&gt; <span class="tok-kw">try</span> printOrdinal(</span>
<span class="line" id="L478">                        writer,</span>
<span class="line" id="L479">                        self.dayOfThisYear() / <span class="tok-number">7</span> + <span class="tok-number">1</span>,</span>
<span class="line" id="L480">                    ),</span>
<span class="line" id="L481">                    .ww =&gt; <span class="tok-kw">try</span> writer.print(</span>
<span class="line" id="L482">                        <span class="tok-str">&quot;{:0&gt;2}&quot;</span>,</span>
<span class="line" id="L483">                        .{self.dayOfThisYear() / <span class="tok-number">7</span> + <span class="tok-number">1</span>},</span>
<span class="line" id="L484">                    ),</span>
<span class="line" id="L485"></span>
<span class="line" id="L486">                    .Y =&gt; <span class="tok-kw">try</span> writer.print(</span>
<span class="line" id="L487">                        <span class="tok-str">&quot;{}&quot;</span>,</span>
<span class="line" id="L488">                        .{self.years + <span class="tok-number">10000</span>},</span>
<span class="line" id="L489">                    ),</span>
<span class="line" id="L490">                    .YY =&gt; <span class="tok-kw">try</span> writer.print(</span>
<span class="line" id="L491">                        <span class="tok-str">&quot;{:0&gt;2}&quot;</span>,</span>
<span class="line" id="L492">                        .{self.years % <span class="tok-number">100</span>},</span>
<span class="line" id="L493">                    ),</span>
<span class="line" id="L494">                    .YYY =&gt; <span class="tok-kw">try</span> writer.print(</span>
<span class="line" id="L495">                        <span class="tok-str">&quot;{}&quot;</span>,</span>
<span class="line" id="L496">                        .{self.years},</span>
<span class="line" id="L497">                    ),</span>
<span class="line" id="L498">                    .YYYY =&gt; <span class="tok-kw">try</span> writer.print(</span>
<span class="line" id="L499">                        <span class="tok-str">&quot;{:0&gt;4}&quot;</span>,</span>
<span class="line" id="L500">                        .{self.years},</span>
<span class="line" id="L501">                    ),</span>
<span class="line" id="L502"></span>
<span class="line" id="L503">                    .N =&gt; <span class="tok-kw">try</span> writer.writeAll(<span class="tok-builtin">@tagName</span>(self.era)),</span>
<span class="line" id="L504">                    .NN =&gt; <span class="tok-kw">try</span> writer.writeAll(<span class="tok-str">&quot;Anno Domini&quot;</span>),</span>
<span class="line" id="L505"></span>
<span class="line" id="L506">                    .A =&gt; <span class="tok-kw">try</span> printLongName(</span>
<span class="line" id="L507">                        writer,</span>
<span class="line" id="L508">                        self.hours / <span class="tok-number">12</span>,</span>
<span class="line" id="L509">                        &amp;[_]string{</span>
<span class="line" id="L510">                            <span class="tok-str">&quot;AM&quot;</span>,</span>
<span class="line" id="L511">                            <span class="tok-str">&quot;PM&quot;</span>,</span>
<span class="line" id="L512">                        },</span>
<span class="line" id="L513">                    ),</span>
<span class="line" id="L514">                    .a =&gt; <span class="tok-kw">try</span> printLongName(</span>
<span class="line" id="L515">                        writer,</span>
<span class="line" id="L516">                        self.hours / <span class="tok-number">12</span>,</span>
<span class="line" id="L517">                        &amp;[_]string{</span>
<span class="line" id="L518">                            <span class="tok-str">&quot;am&quot;</span>,</span>
<span class="line" id="L519">                            <span class="tok-str">&quot;pm&quot;</span>,</span>
<span class="line" id="L520">                        },</span>
<span class="line" id="L521">                    ),</span>
<span class="line" id="L522"></span>
<span class="line" id="L523">                    .H =&gt; <span class="tok-kw">try</span> writer.print(</span>
<span class="line" id="L524">                        <span class="tok-str">&quot;{}&quot;</span>,</span>
<span class="line" id="L525">                        .{self.hours},</span>
<span class="line" id="L526">                    ),</span>
<span class="line" id="L527">                    .HH =&gt; <span class="tok-kw">try</span> writer.print(</span>
<span class="line" id="L528">                        <span class="tok-str">&quot;{:0&gt;2}&quot;</span>,</span>
<span class="line" id="L529">                        .{self.hours},</span>
<span class="line" id="L530">                    ),</span>
<span class="line" id="L531">                    .h =&gt; <span class="tok-kw">try</span> writer.print(<span class="tok-str">&quot;{}&quot;</span>, .{wrap(</span>
<span class="line" id="L532">                        self.hours,</span>
<span class="line" id="L533">                        <span class="tok-number">12</span>,</span>
<span class="line" id="L534">                    )}),</span>
<span class="line" id="L535">                    .hh =&gt; <span class="tok-kw">try</span> writer.print(<span class="tok-str">&quot;{:0&gt;2}&quot;</span>, .{wrap(</span>
<span class="line" id="L536">                        self.hours,</span>
<span class="line" id="L537">                        <span class="tok-number">12</span>,</span>
<span class="line" id="L538">                    )}),</span>
<span class="line" id="L539">                    .k =&gt; <span class="tok-kw">try</span> writer.print(<span class="tok-str">&quot;{}&quot;</span>, .{wrap(</span>
<span class="line" id="L540">                        self.hours,</span>
<span class="line" id="L541">                        <span class="tok-number">24</span>,</span>
<span class="line" id="L542">                    )}),</span>
<span class="line" id="L543">                    .kk =&gt; <span class="tok-kw">try</span> writer.print(<span class="tok-str">&quot;{:0&gt;2}&quot;</span>, .{wrap(</span>
<span class="line" id="L544">                        self.hours,</span>
<span class="line" id="L545">                        <span class="tok-number">24</span>,</span>
<span class="line" id="L546">                    )}),</span>
<span class="line" id="L547"></span>
<span class="line" id="L548">                    .m =&gt; <span class="tok-kw">try</span> writer.print(</span>
<span class="line" id="L549">                        <span class="tok-str">&quot;{}&quot;</span>,</span>
<span class="line" id="L550">                        .{self.minutes},</span>
<span class="line" id="L551">                    ),</span>
<span class="line" id="L552">                    .mm =&gt; <span class="tok-kw">try</span> writer.print(</span>
<span class="line" id="L553">                        <span class="tok-str">&quot;{:0&gt;2}&quot;</span>,</span>
<span class="line" id="L554">                        .{self.minutes},</span>
<span class="line" id="L555">                    ),</span>
<span class="line" id="L556"></span>
<span class="line" id="L557">                    .s =&gt; <span class="tok-kw">try</span> writer.print(</span>
<span class="line" id="L558">                        <span class="tok-str">&quot;{}&quot;</span>,</span>
<span class="line" id="L559">                        .{self.seconds},</span>
<span class="line" id="L560">                    ),</span>
<span class="line" id="L561">                    .ss =&gt; <span class="tok-kw">try</span> writer.print(</span>
<span class="line" id="L562">                        <span class="tok-str">&quot;{:0&gt;2}&quot;</span>,</span>
<span class="line" id="L563">                        .{self.seconds},</span>
<span class="line" id="L564">                    ),</span>
<span class="line" id="L565"></span>
<span class="line" id="L566">                    .S =&gt; <span class="tok-kw">try</span> writer.print(</span>
<span class="line" id="L567">                        <span class="tok-str">&quot;{}&quot;</span>,</span>
<span class="line" id="L568">                        .{self.ms / <span class="tok-number">100</span>},</span>
<span class="line" id="L569">                    ),</span>
<span class="line" id="L570">                    .SS =&gt; <span class="tok-kw">try</span> writer.print(</span>
<span class="line" id="L571">                        <span class="tok-str">&quot;{:0&gt;2}&quot;</span>,</span>
<span class="line" id="L572">                        .{self.ms / <span class="tok-number">10</span>},</span>
<span class="line" id="L573">                    ),</span>
<span class="line" id="L574">                    .SSS =&gt; <span class="tok-kw">try</span> writer.print(</span>
<span class="line" id="L575">                        <span class="tok-str">&quot;{:0&gt;3}&quot;</span>,</span>
<span class="line" id="L576">                        .{self.ms},</span>
<span class="line" id="L577">                    ),</span>
<span class="line" id="L578"></span>
<span class="line" id="L579">                    .z =&gt; <span class="tok-kw">try</span> writer.writeAll(<span class="tok-builtin">@tagName</span>(self.timezone)),</span>
<span class="line" id="L580">                    .Z =&gt; <span class="tok-kw">try</span> writer.writeAll(<span class="tok-str">&quot;+00:00&quot;</span>),</span>
<span class="line" id="L581">                    .ZZ =&gt; <span class="tok-kw">try</span> writer.writeAll(<span class="tok-str">&quot;+0000&quot;</span>),</span>
<span class="line" id="L582"></span>
<span class="line" id="L583">                    .x =&gt; <span class="tok-kw">try</span> writer.print(</span>
<span class="line" id="L584">                        <span class="tok-str">&quot;{}&quot;</span>,</span>
<span class="line" id="L585">                        .{self.toUnixMilli()},</span>
<span class="line" id="L586">                    ),</span>
<span class="line" id="L587">                    .X =&gt; <span class="tok-kw">try</span> writer.print(</span>
<span class="line" id="L588">                        <span class="tok-str">&quot;{}&quot;</span>,</span>
<span class="line" id="L589">                        .{self.toUnix()},</span>
<span class="line" id="L590">                    ),</span>
<span class="line" id="L591">                }</span>
<span class="line" id="L592">                next = <span class="tok-null">null</span>;</span>
<span class="line" id="L593">                s = i;</span>
<span class="line" id="L594">            }</span>
<span class="line" id="L595"></span>
<span class="line" id="L596">            <span class="tok-kw">switch</span> (c) {</span>
<span class="line" id="L597">                <span class="tok-str">','</span>,</span>
<span class="line" id="L598">                <span class="tok-str">' '</span>,</span>
<span class="line" id="L599">                <span class="tok-str">':'</span>,</span>
<span class="line" id="L600">                <span class="tok-str">'-'</span>,</span>
<span class="line" id="L601">                <span class="tok-str">'.'</span>,</span>
<span class="line" id="L602">                <span class="tok-str">'T'</span>,</span>
<span class="line" id="L603">                <span class="tok-str">'W'</span>,</span>
<span class="line" id="L604">                =&gt; {</span>
<span class="line" id="L605">                    <span class="tok-kw">try</span> writer.writeAll(&amp;.{c});</span>
<span class="line" id="L606">                    s = i + <span class="tok-number">1</span>;</span>
<span class="line" id="L607">                    <span class="tok-kw">continue</span>;</span>
<span class="line" id="L608">                },</span>
<span class="line" id="L609">                <span class="tok-kw">else</span> =&gt; {},</span>
<span class="line" id="L610">            }</span>
<span class="line" id="L611">        }</span>
<span class="line" id="L612">    }</span>
<span class="line" id="L613"></span>
<span class="line" id="L614">    <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">formatAlloc</span>(</span>
<span class="line" id="L615">        self: Self,</span>
<span class="line" id="L616">        alloc: std.mem.Allocator,</span>
<span class="line" id="L617">        <span class="tok-kw">comptime</span> fmt: string,</span>
<span class="line" id="L618">    ) !string {</span>
<span class="line" id="L619">        <span class="tok-kw">var</span> list = std.ArrayList(<span class="tok-type">u8</span>).init(alloc);</span>
<span class="line" id="L620">        <span class="tok-kw">defer</span> list.deinit();</span>
<span class="line" id="L621"></span>
<span class="line" id="L622">        <span class="tok-kw">try</span> self.format(</span>
<span class="line" id="L623">            fmt,</span>
<span class="line" id="L624">            .{},</span>
<span class="line" id="L625">            list.writer(),</span>
<span class="line" id="L626">        );</span>
<span class="line" id="L627">        <span class="tok-kw">return</span> list.toOwnedSlice();</span>
<span class="line" id="L628">    }</span>
<span class="line" id="L629"></span>
<span class="line" id="L630">    <span class="tok-kw">const</span> FormatSeq = <span class="tok-kw">enum</span> {</span>
<span class="line" id="L631">        M, <span class="tok-comment">// 1 2 ... 11 12</span>
</span>
<span class="line" id="L632">        Mo, <span class="tok-comment">// 1st 2nd ... 11th 12th</span>
</span>
<span class="line" id="L633">        MM, <span class="tok-comment">// 01 02 ... 11 12</span>
</span>
<span class="line" id="L634">        MMM, <span class="tok-comment">// Jan Feb ... Nov Dec</span>
</span>
<span class="line" id="L635">        MMMM, <span class="tok-comment">// January February ... November December</span>
</span>
<span class="line" id="L636">        Q, <span class="tok-comment">// 1 2 3 4</span>
</span>
<span class="line" id="L637">        Qo, <span class="tok-comment">// 1st 2nd 3rd 4th</span>
</span>
<span class="line" id="L638">        D, <span class="tok-comment">// 1 2 ... 30 31</span>
</span>
<span class="line" id="L639">        Do, <span class="tok-comment">// 1st 2nd ... 30th 31st</span>
</span>
<span class="line" id="L640">        DD, <span class="tok-comment">// 01 02 ... 30 31</span>
</span>
<span class="line" id="L641">        DDD, <span class="tok-comment">// 1 2 ... 364 365</span>
</span>
<span class="line" id="L642">        DDDo, <span class="tok-comment">// 1st 2nd ... 364th 365th</span>
</span>
<span class="line" id="L643">        DDDD, <span class="tok-comment">// 001 002 ... 364 365</span>
</span>
<span class="line" id="L644">        d, <span class="tok-comment">// 0 1 ... 5 6</span>
</span>
<span class="line" id="L645">        do, <span class="tok-comment">// 0th 1st ... 5th 6th</span>
</span>
<span class="line" id="L646">        dd, <span class="tok-comment">// Su Mo ... Fr Sa</span>
</span>
<span class="line" id="L647">        ddd, <span class="tok-comment">// Sun Mon ... Fri Sat</span>
</span>
<span class="line" id="L648">        dddd, <span class="tok-comment">// Sunday Monday ... Friday Saturday</span>
</span>
<span class="line" id="L649">        e, <span class="tok-comment">// 0 1 ... 5 6 (locale)</span>
</span>
<span class="line" id="L650">        E, <span class="tok-comment">// 1 2 ... 6 7 (ISO)</span>
</span>
<span class="line" id="L651">        w, <span class="tok-comment">// 1 2 ... 52 53</span>
</span>
<span class="line" id="L652">        wo, <span class="tok-comment">// 1st 2nd ... 52nd 53rd</span>
</span>
<span class="line" id="L653">        ww, <span class="tok-comment">// 01 02 ... 52 53</span>
</span>
<span class="line" id="L654">        Y, <span class="tok-comment">// 11970 11971 ... 19999 20000 20001 (Holocene calendar)</span>
</span>
<span class="line" id="L655">        YY, <span class="tok-comment">// 70 71 ... 29 30</span>
</span>
<span class="line" id="L656">        YYY, <span class="tok-comment">// 1 2 ... 1970 1971 ... 2029 2030</span>
</span>
<span class="line" id="L657">        YYYY, <span class="tok-comment">// 0001 0002 ... 1970 1971 ... 2029 2030</span>
</span>
<span class="line" id="L658">        N, <span class="tok-comment">// BC AD</span>
</span>
<span class="line" id="L659">        NN, <span class="tok-comment">// Before Christ ... Anno Domini</span>
</span>
<span class="line" id="L660">        A, <span class="tok-comment">// AM PM</span>
</span>
<span class="line" id="L661">        a, <span class="tok-comment">// am pm</span>
</span>
<span class="line" id="L662">        H, <span class="tok-comment">// 0 1 ... 22 23</span>
</span>
<span class="line" id="L663">        HH, <span class="tok-comment">// 00 01 ... 22 23</span>
</span>
<span class="line" id="L664">        h, <span class="tok-comment">// 1 2 ... 11 12</span>
</span>
<span class="line" id="L665">        hh, <span class="tok-comment">// 01 02 ... 11 12</span>
</span>
<span class="line" id="L666">        k, <span class="tok-comment">// 1 2 ... 23 24</span>
</span>
<span class="line" id="L667">        kk, <span class="tok-comment">// 01 02 ... 23 24</span>
</span>
<span class="line" id="L668">        m, <span class="tok-comment">// 0 1 ... 58 59</span>
</span>
<span class="line" id="L669">        mm, <span class="tok-comment">// 00 01 ... 58 59</span>
</span>
<span class="line" id="L670">        s, <span class="tok-comment">// 0 1 ... 58 59</span>
</span>
<span class="line" id="L671">        ss, <span class="tok-comment">// 00 01 ... 58 59</span>
</span>
<span class="line" id="L672">        S, <span class="tok-comment">// 0 1 ... 8 9 (second fraction)</span>
</span>
<span class="line" id="L673">        SS, <span class="tok-comment">// 00 01 ... 98 99</span>
</span>
<span class="line" id="L674">        SSS, <span class="tok-comment">// 000 001 ... 998 999</span>
</span>
<span class="line" id="L675">        z, <span class="tok-comment">// EST CST ... MST PST</span>
</span>
<span class="line" id="L676">        Z, <span class="tok-comment">// -07:00 -06:00 ... +06:00 +07:00</span>
</span>
<span class="line" id="L677">        ZZ, <span class="tok-comment">// -0700 -0600 ... +0600 +0700</span>
</span>
<span class="line" id="L678">        x, <span class="tok-comment">// unix milli</span>
</span>
<span class="line" id="L679">        X, <span class="tok-comment">// unix</span>
</span>
<span class="line" id="L680">    };</span>
<span class="line" id="L681"></span>
<span class="line" id="L682">    <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">since</span>(</span>
<span class="line" id="L683">        self: Self,</span>
<span class="line" id="L684">        other_in_the_past: Self,</span>
<span class="line" id="L685">    ) Duration {</span>
<span class="line" id="L686">        <span class="tok-kw">return</span> Duration{</span>
<span class="line" id="L687">            .ms = self.toUnixMilli() - other_in_the_past.toUnixMilli(),</span>
<span class="line" id="L688">        };</span>
<span class="line" id="L689">    }</span>
<span class="line" id="L690">};</span>
<span class="line" id="L691"></span>
<span class="line" id="L692"><span class="tok-kw">pub</span> <span class="tok-kw">const</span> format = <span class="tok-kw">struct</span> {</span>
<span class="line" id="L693">    <span class="tok-kw">pub</span> <span class="tok-kw">const</span> LT = <span class="tok-str">&quot;&quot;</span>;</span>
<span class="line" id="L694">    <span class="tok-kw">pub</span> <span class="tok-kw">const</span> LTS = <span class="tok-str">&quot;&quot;</span>;</span>
<span class="line" id="L695">    <span class="tok-kw">pub</span> <span class="tok-kw">const</span> L = <span class="tok-str">&quot;&quot;</span>;</span>
<span class="line" id="L696">    <span class="tok-kw">pub</span> <span class="tok-kw">const</span> l = <span class="tok-str">&quot;&quot;</span>;</span>
<span class="line" id="L697">    <span class="tok-kw">pub</span> <span class="tok-kw">const</span> LL = <span class="tok-str">&quot;&quot;</span>;</span>
<span class="line" id="L698">    <span class="tok-kw">pub</span> <span class="tok-kw">const</span> ll = <span class="tok-str">&quot;&quot;</span>;</span>
<span class="line" id="L699">    <span class="tok-kw">pub</span> <span class="tok-kw">const</span> LLL = <span class="tok-str">&quot;&quot;</span>;</span>
<span class="line" id="L700">    <span class="tok-kw">pub</span> <span class="tok-kw">const</span> lll = <span class="tok-str">&quot;&quot;</span>;</span>
<span class="line" id="L701">    <span class="tok-kw">pub</span> <span class="tok-kw">const</span> LLLL = <span class="tok-str">&quot;&quot;</span>;</span>
<span class="line" id="L702">    <span class="tok-kw">pub</span> <span class="tok-kw">const</span> llll = <span class="tok-str">&quot;&quot;</span>;</span>
<span class="line" id="L703">};</span>
<span class="line" id="L704"></span>
<span class="line" id="L705"><span class="tok-kw">pub</span> <span class="tok-kw">const</span> TimeZone = <span class="tok-kw">enum</span> {</span>
<span class="line" id="L706">    UTC,</span>
<span class="line" id="L707">};</span>
<span class="line" id="L708"></span>
<span class="line" id="L709"><span class="tok-kw">pub</span> <span class="tok-kw">const</span> WeekDay = <span class="tok-kw">enum</span> {</span>
<span class="line" id="L710">    Sun,</span>
<span class="line" id="L711">    Mon,</span>
<span class="line" id="L712">    Tue,</span>
<span class="line" id="L713">    Wed,</span>
<span class="line" id="L714">    Thu,</span>
<span class="line" id="L715">    Fri,</span>
<span class="line" id="L716">    Sat,</span>
<span class="line" id="L717"></span>
<span class="line" id="L718">    <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">next</span>(self: WeekDay) WeekDay {</span>
<span class="line" id="L719">        <span class="tok-kw">return</span> <span class="tok-kw">switch</span> (self) {</span>
<span class="line" id="L720">            .Sun =&gt; .Mon,</span>
<span class="line" id="L721">            .Mon =&gt; .Tue,</span>
<span class="line" id="L722">            .Tue =&gt; .Wed,</span>
<span class="line" id="L723">            .Wed =&gt; .Thu,</span>
<span class="line" id="L724">            .Thu =&gt; .Fri,</span>
<span class="line" id="L725">            .Fri =&gt; .Sat,</span>
<span class="line" id="L726">            .Sat =&gt; .Sun,</span>
<span class="line" id="L727">        };</span>
<span class="line" id="L728">    }</span>
<span class="line" id="L729">};</span>
<span class="line" id="L730"></span>
<span class="line" id="L731"><span class="tok-kw">pub</span> <span class="tok-kw">const</span> Era = <span class="tok-kw">enum</span> {</span>
<span class="line" id="L732">    <span class="tok-comment">// BC,</span>
</span>
<span class="line" id="L733">    AD,</span>
<span class="line" id="L734">};</span>
<span class="line" id="L735"></span>
<span class="line" id="L736"><span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">isLeapYear</span>(year: <span class="tok-type">u16</span>) <span class="tok-type">bool</span> {</span>
<span class="line" id="L737">    <span class="tok-kw">var</span> ret = <span class="tok-null">false</span>;</span>
<span class="line" id="L738">    <span class="tok-kw">if</span> (year % <span class="tok-number">4</span> == <span class="tok-number">0</span>) ret = <span class="tok-null">true</span>;</span>
<span class="line" id="L739">    <span class="tok-kw">if</span> (year % <span class="tok-number">100</span> == <span class="tok-number">0</span>) ret = <span class="tok-null">false</span>;</span>
<span class="line" id="L740">    <span class="tok-kw">if</span> (year % <span class="tok-number">400</span> == <span class="tok-number">0</span>) ret = <span class="tok-null">true</span>;</span>
<span class="line" id="L741">    <span class="tok-kw">return</span> ret;</span>
<span class="line" id="L742">}</span>
<span class="line" id="L743"></span>
<span class="line" id="L744"><span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">daysInYear</span>(year: <span class="tok-type">u16</span>) <span class="tok-type">u16</span> {</span>
<span class="line" id="L745">    <span class="tok-kw">return</span> <span class="tok-kw">if</span> (isLeapYear(year)) <span class="tok-number">366</span> <span class="tok-kw">else</span> <span class="tok-number">365</span>;</span>
<span class="line" id="L746">}</span>
<span class="line" id="L747"></span>
<span class="line" id="L748"><span class="tok-kw">fn</span> <span class="tok-fn">daysInMonth</span>(</span>
<span class="line" id="L749">    year: <span class="tok-type">u16</span>,</span>
<span class="line" id="L750">    month: <span class="tok-type">u16</span>,</span>
<span class="line" id="L751">) <span class="tok-type">u16</span> {</span>
<span class="line" id="L752">    <span class="tok-kw">const</span> norm = [<span class="tok-number">12</span>]<span class="tok-type">u16</span>{</span>
<span class="line" id="L753">        <span class="tok-number">31</span>,</span>
<span class="line" id="L754">        <span class="tok-number">28</span>,</span>
<span class="line" id="L755">        <span class="tok-number">31</span>,</span>
<span class="line" id="L756">        <span class="tok-number">30</span>,</span>
<span class="line" id="L757">        <span class="tok-number">31</span>,</span>
<span class="line" id="L758">        <span class="tok-number">30</span>,</span>
<span class="line" id="L759">        <span class="tok-number">31</span>,</span>
<span class="line" id="L760">        <span class="tok-number">31</span>,</span>
<span class="line" id="L761">        <span class="tok-number">30</span>,</span>
<span class="line" id="L762">        <span class="tok-number">31</span>,</span>
<span class="line" id="L763">        <span class="tok-number">30</span>,</span>
<span class="line" id="L764">        <span class="tok-number">31</span>,</span>
<span class="line" id="L765">    };</span>
<span class="line" id="L766">    <span class="tok-kw">const</span> leap = [<span class="tok-number">12</span>]<span class="tok-type">u16</span>{</span>
<span class="line" id="L767">        <span class="tok-number">31</span>,</span>
<span class="line" id="L768">        <span class="tok-number">29</span>,</span>
<span class="line" id="L769">        <span class="tok-number">31</span>,</span>
<span class="line" id="L770">        <span class="tok-number">30</span>,</span>
<span class="line" id="L771">        <span class="tok-number">31</span>,</span>
<span class="line" id="L772">        <span class="tok-number">30</span>,</span>
<span class="line" id="L773">        <span class="tok-number">31</span>,</span>
<span class="line" id="L774">        <span class="tok-number">31</span>,</span>
<span class="line" id="L775">        <span class="tok-number">30</span>,</span>
<span class="line" id="L776">        <span class="tok-number">31</span>,</span>
<span class="line" id="L777">        <span class="tok-number">30</span>,</span>
<span class="line" id="L778">        <span class="tok-number">31</span>,</span>
<span class="line" id="L779">    };</span>
<span class="line" id="L780">    <span class="tok-kw">const</span> month_days = <span class="tok-kw">if</span> (!isLeapYear(year)) norm <span class="tok-kw">else</span> leap;</span>
<span class="line" id="L781">    <span class="tok-kw">return</span> month_days[month];</span>
<span class="line" id="L782">}</span>
<span class="line" id="L783"></span>
<span class="line" id="L784"><span class="tok-kw">fn</span> <span class="tok-fn">printOrdinal</span>(</span>
<span class="line" id="L785">    writer: <span class="tok-kw">anytype</span>,</span>
<span class="line" id="L786">    num: <span class="tok-type">u16</span>,</span>
<span class="line" id="L787">) !<span class="tok-type">void</span> {</span>
<span class="line" id="L788">    <span class="tok-kw">try</span> writer.print(</span>
<span class="line" id="L789">        <span class="tok-str">&quot;{}&quot;</span>,</span>
<span class="line" id="L790">        .{num},</span>
<span class="line" id="L791">    );</span>
<span class="line" id="L792">    <span class="tok-kw">try</span> writer.writeAll(<span class="tok-kw">switch</span> (num) {</span>
<span class="line" id="L793">        <span class="tok-number">1</span> =&gt; <span class="tok-str">&quot;st&quot;</span>,</span>
<span class="line" id="L794">        <span class="tok-number">2</span> =&gt; <span class="tok-str">&quot;nd&quot;</span>,</span>
<span class="line" id="L795">        <span class="tok-number">3</span> =&gt; <span class="tok-str">&quot;rd&quot;</span>,</span>
<span class="line" id="L796">        <span class="tok-kw">else</span> =&gt; <span class="tok-str">&quot;th&quot;</span>,</span>
<span class="line" id="L797">    });</span>
<span class="line" id="L798">}</span>
<span class="line" id="L799"></span>
<span class="line" id="L800"><span class="tok-kw">fn</span> <span class="tok-fn">printLongName</span>(</span>
<span class="line" id="L801">    writer: <span class="tok-kw">anytype</span>,</span>
<span class="line" id="L802">    index: <span class="tok-type">u16</span>,</span>
<span class="line" id="L803">    names: []<span class="tok-kw">const</span> string,</span>
<span class="line" id="L804">) !<span class="tok-type">void</span> {</span>
<span class="line" id="L805">    <span class="tok-kw">try</span> writer.writeAll(names[index]);</span>
<span class="line" id="L806">}</span>
<span class="line" id="L807"></span>
<span class="line" id="L808"><span class="tok-kw">fn</span> <span class="tok-fn">wrap</span>(</span>
<span class="line" id="L809">    val: <span class="tok-type">u16</span>,</span>
<span class="line" id="L810">    at: <span class="tok-type">u16</span>,</span>
<span class="line" id="L811">) <span class="tok-type">u16</span> {</span>
<span class="line" id="L812">    <span class="tok-kw">var</span> tmp = val % at;</span>
<span class="line" id="L813">    <span class="tok-kw">return</span> <span class="tok-kw">if</span> (tmp == <span class="tok-number">0</span>) at <span class="tok-kw">else</span> tmp;</span>
<span class="line" id="L814">}</span>
<span class="line" id="L815"></span>
<span class="line" id="L816"><span class="tok-kw">pub</span> <span class="tok-kw">const</span> Duration = <span class="tok-kw">struct</span> {</span>
<span class="line" id="L817">    ms: <span class="tok-type">u64</span>,</span>
<span class="line" id="L818">};</span>
<span class="line" id="L819"></span>
<span class="line" id="L820"><span class="tok-comment">// ************************************************************</span>
</span>
<span class="line" id="L821"><span class="tok-comment">// *                         TESTS                            *</span>
</span>
<span class="line" id="L822"><span class="tok-comment">// ************************************************************</span>
</span>
<span class="line" id="L823"><span class="tok-kw">const</span> expect = std.testing.expect;</span>
<span class="line" id="L824"><span class="tok-kw">test</span> <span class="tok-str">&quot;time format&quot;</span> {</span>
<span class="line" id="L825">    <span class="tok-comment">// Initialize an allocator.</span>
</span>
<span class="line" id="L826">    <span class="tok-kw">var</span> allocator = std.testing.allocator;</span>
<span class="line" id="L827">    <span class="tok-kw">const</span> utc_format = <span class="tok-str">&quot;YYYY-MM-DDTHH:mm:ss&quot;</span>;</span>
<span class="line" id="L828">    <span class="tok-kw">const</span> dt = DateTime.initUnix(<span class="tok-number">1697696484</span>);</span>
<span class="line" id="L829">    <span class="tok-kw">const</span> formatted_dt = <span class="tok-kw">try</span> dt.formatAlloc(</span>
<span class="line" id="L830">        allocator,</span>
<span class="line" id="L831">        utc_format,</span>
<span class="line" id="L832">    );</span>
<span class="line" id="L833">    <span class="tok-kw">defer</span> allocator.free(formatted_dt); <span class="tok-comment">// Free the memory allocated by the allocator.</span>
</span>
<span class="line" id="L834">    <span class="tok-kw">const</span> expected_formatted_dt = <span class="tok-str">&quot;2023-10-19T06:21:24&quot;</span>;</span>
<span class="line" id="L835">    <span class="tok-kw">try</span> expect(std.mem.eql(</span>
<span class="line" id="L836">        <span class="tok-type">u8</span>,</span>
<span class="line" id="L837">        formatted_dt,</span>
<span class="line" id="L838">        expected_formatted_dt,</span>
<span class="line" id="L839">    ));</span>
<span class="line" id="L840">}</span>
<span class="line" id="L841"></span>
</code></pre></body>
</html>